---
phase: 02-onboarding-experience
plan: 02
type: execute
---

<objective>
Implement guided first search walkthrough and enhanced score tooltips.

Purpose: Guide new users through their first successful search and help them understand what makes a high-scoring prospect valuable.
Output: 5-step guided tour with tooltips and rich score explanation tooltips that replace the current `(?)` markers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-onboarding-experience/02-01-SUMMARY.md

**Spec reference:**
@docs/product/pcc-onboarding-flow.md

**Existing code:**
@prospect/web/templates/index.html
@prospect/web/templates/partials/results.html
@prospect/web/templates/base.html
@prospect/web/api/v1/onboarding.py

**Tech stack available:** FastAPI, Jinja2, HTMX, Tailwind CSS via CDN, vanilla JS
**Established patterns:** HTMX for interactivity, Tailwind for styling

**From spec (Section 2.1 Steps 2-5):**
- Step 2: Search bar highlight with tooltip "Start here - Type any company name..."
- Step 3: Results explanation after first search - score meaning (80+=Strong, 60-79=Solid, etc.)
- Step 4: Score breakdown prompt - "Click to see why"
- Step 5: Completion toast - "Nice work! You've completed your first search."

**From spec (Section 2.3 Tooltips):**
- Fit Score: "Based on contact info availability, how reachable is this prospect"
- Opportunity Score: "Based on missing analytics, old CMS, no booking system - how much do they need marketing help"
- Priority Score: "Combined score - higher means better prospect to contact"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create guided search walkthrough</name>
  <files>prospect/web/templates/partials/onboarding_tour.html, prospect/web/templates/index.html, prospect/web/static/js/onboarding.js</files>
  <action>
1. Create onboarding_tour.html partial with tour step templates:
   - Step structure: positioned tooltip with arrow, highlight ring on target element
   - Each step has: title, body text, "Next"/"Got it" button
   - Use CSS classes for positioning (top, bottom, left, right of target)
   - Include step indicator (e.g., "Step 2 of 4")

2. Create onboarding.js with tour logic:
   - TourManager class to handle step progression
   - Steps array defining: target element selector, position, content
   - Methods: start(), next(), skip(), complete()
   - On complete: POST to /api/v1/onboarding/step/first_search
   - Store current step in sessionStorage to survive page refresh during tour
   - Highlight effect: add ring-2 ring-brand-500 ring-offset-2 to target element

3. Tour steps (from spec Section 2.1):
   Step 1 (after welcome modal): Search bar highlight
   - Target: #business_type input
   - Tooltip: "Start here - Type any company name. We'll pull their credibility score and full profile."
   - Position: below input
   - Pulse animation on search bar

   Step 2: After search submitted (detect via HTMX htmx:afterSwap on #results-container)
   - Target: First score badge in results
   - Tooltip: "This is their Credibility Score - 0-100 based on 50+ signals..."
   - Include quick guide: 80+=Strong, 60-79=Solid, 40-59=Mixed, Below 40=Concerns

   Step 3: Score breakdown prompt
   - Target: First opportunity_notes cell
   - Tooltip: "Click to see why - The overall score is useful. The breakdown shows exactly what's driving it."

   Step 4: Completion
   - Show toast notification: "Nice work! You've completed your first search. The rest works the same way."
   - Mark onboarding step complete

4. Update index.html:
   - Include onboarding_tour.html partial
   - Include onboarding.js script
   - Pass tour_active context variable (true if onboarding_step == 1)
   - Add HTMX event listener to trigger Step 2 after results load

Handle edge cases:
- User navigates away mid-tour: resume from sessionStorage on return
- User already completed search: skip to appropriate step
- No results returned: show alternate completion message
  </action>
  <verify>
Start tour by clicking "Let's go" on welcome modal, verify each step appears at correct position with correct content
  </verify>
  <done>
4-step tour guides user through first search, steps appear at correct elements, tour state persists across interactions, completion marks onboarding step
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance score tooltips</name>
  <files>prospect/web/templates/partials/results.html, prospect/web/templates/partials/score_tooltip.html</files>
  <action>
1. Create score_tooltip.html partial:
   - Reusable tooltip component with:
     - Dark background (bg-gray-900 text-white)
     - Rounded corners, shadow
     - Arrow pointing to trigger element
     - Support for multi-line content
   - Use CSS :hover or JS for show/hide (prefer CSS for simplicity)
   - Position: appears above the score badge

2. Update results.html to use rich tooltips:

   Replace current title attributes on score badges with tooltip components:

   Fit Score tooltip (from spec Section 2.3):
   - Title: "Fit Score"
   - Body: "How reachable is this prospect? Based on contact info availability - phone, email, address."
   - Scale: "High (60+) = Easy to contact, Low (<40) = Hard to reach"

   Opportunity Score tooltip (from spec Section 2.3):
   - Title: "Opportunity Score"
   - Body: "How much do they need marketing help? Based on missing analytics, old CMS, no booking system, slow site."
   - Scale: "High (60+) = Significant gaps, Low (<40) = Already well-equipped"

   Priority Score tooltip (from spec Section 2.3):
   - Title: "Priority Score"
   - Body: "Combined ranking score. Higher = better prospect to contact first."
   - Formula hint: "Fit × Opportunity weighted average"

3. Update table header tooltips:
   - Replace the (?) markers with info icons (i in circle)
   - Same rich tooltip on hover
   - Accessible: use aria-describedby for screen readers

4. Add onboarding step tracking:
   - When user hovers over any score tooltip for first time, POST to /api/v1/onboarding/step/score_explained
   - Only trigger once (check sessionStorage flag)
   - This completes onboarding (step 3 = final step)

Styling should match existing UI - use Tailwind classes, keep tooltips compact but informative.
  </action>
  <verify>
Hover over any score badge in results table, rich tooltip should appear with title, description, and scale explanation
  </verify>
  <done>
All three score types have rich hover tooltips, tooltips are accessible, first tooltip hover marks onboarding complete
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete onboarding experience: guided tour and rich score tooltips</what-built>
  <how-to-verify>
    1. Start dev server: `make run` or `uvicorn prospect.web.app:app --reload`
    2. Reset user onboarding (set onboarding_step=0, onboarding_completed=False in DB)
    3. Login and verify welcome modal appears
    4. Click "Let's go →" and verify:
       - Search bar gets highlight ring and tooltip appears below
       - Tooltip shows "Start here..." text
    5. Enter a search (e.g., "plumber" in "Brisbane") and submit
    6. After results load, verify:
       - New tooltip appears pointing to first score
       - Shows score explanation with 80+/60-79/40-59/<40 guide
    7. Click "Got it" and verify next tooltip appears at opportunity notes
    8. Complete tour and verify:
       - Toast notification "Nice work!" appears
       - GET /api/v1/onboarding/status shows current_step=2 (first_search)
    9. Hover over any score badge in results:
       - Rich tooltip appears with title, description, scale
       - After first hover, onboarding should complete (current_step=4)
    10. Refresh page - no tour elements should appear
  </how-to-verify>
  <resume-signal>Type "approved" if onboarding flow works end-to-end, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Tour starts after welcome modal "Let's go" click
- [ ] Tour steps appear at correct elements with correct content
- [ ] Tour state persists if page refreshes during tour
- [ ] Results trigger tour step 2 via HTMX event
- [ ] Score tooltips show rich content on hover
- [ ] Tooltips are accessible (keyboard navigable, screen reader friendly)
- [ ] Onboarding completes after first score tooltip hover
- [ ] No console errors
- [ ] No visual regressions to existing UI
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Full onboarding flow works for new users
- Existing users see score tooltips but no tour
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-onboarding-experience/02-02-SUMMARY.md` with:
- Phase 2 complete status
- All onboarding components implemented
- Ready for Phase 3 (Score Visibility)
</output>
