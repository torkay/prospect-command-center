---
phase: 02-onboarding-experience
plan: 01
type: execute
---

<objective>
Implement onboarding backend API and welcome modal for first-time users.

Purpose: Enable tracking of user onboarding state and display a welcome modal that communicates PCC's value proposition on first login.
Output: Working onboarding status API and welcome modal that appears once for new users.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-production-hardening/01-01-SUMMARY.md

**Spec reference:**
@docs/product/pcc-onboarding-flow.md

**Existing code:**
@prospect/web/api/v1/onboarding.py
@prospect/web/database.py
@prospect/web/templates/base.html
@prospect/web/templates/index.html

**Tech stack available:** FastAPI, Jinja2, HTMX, Tailwind CSS via CDN
**Established patterns:** Fail-fast validation, HTMX for interactivity

**Constraining decisions:**
- Phase 01: onboarding.py stub created, ready for implementation
- User model already has onboarding_completed, onboarding_step, first_login_at fields

**From spec (Section 2.1):**
- Welcome modal headline: "Welcome to PCC"
- Body: "You're about to run professional-grade company research. Let's do your first search together — it takes 30 seconds."
- CTA: "Let's go →"
- Skip link: "I'll figure it out"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete onboarding API endpoints</name>
  <files>prospect/web/api/v1/onboarding.py</files>
  <action>
Replace stub with full implementation:

1. GET /onboarding/status - Return current user's onboarding state:
   - completed: bool (from user.onboarding_completed)
   - current_step: int (from user.onboarding_step)
   - steps: dict with step names and completion status
   - Steps: 0=not_started, 1=welcome_seen, 2=first_search, 3=score_explained, 4=complete

2. POST /onboarding/step/{step_name} - Mark a step complete:
   - Valid step_names: welcome_seen, first_search, score_explained
   - Update user.onboarding_step to appropriate number
   - If step 3 (score_explained) completed, set onboarding_completed=True
   - Return updated status

3. POST /onboarding/skip - Skip onboarding entirely:
   - Set onboarding_completed=True, onboarding_step=4
   - Return confirmation

Require authentication for all endpoints (use existing get_current_user dependency from auth.py).
Return 401 if not authenticated.
  </action>
  <verify>
curl -X GET http://localhost:8000/api/v1/onboarding/status -H "Authorization: Bearer {token}" returns JSON with completed, current_step, steps fields
  </verify>
  <done>
All three endpoints return correct JSON, require auth, update user record in database
  </done>
</task>

<task type="auto">
  <name>Task 2: Create welcome modal component</name>
  <files>prospect/web/templates/partials/welcome_modal.html, prospect/web/templates/index.html, prospect/web/api/v1/prospects.py</files>
  <action>
1. Create welcome_modal.html partial:
   - Modal overlay with semi-transparent background
   - Centered card with:
     - Headline: "Welcome to PCC"
     - Body text from spec (Section 2.1)
     - Primary CTA button: "Let's go →" (closes modal, marks welcome_seen via HTMX POST)
     - Secondary link: "I'll figure it out" (closes modal, calls skip endpoint)
   - Use Tailwind classes matching existing UI (brand-600 for primary button)
   - Add data attribute for JS to check if modal was shown
   - Modal should be dismissible by clicking outside or pressing Escape

2. Update index.html:
   - Include welcome_modal.html partial
   - Pass show_welcome_modal context variable
   - Add minimal JS to handle modal open/close and keyboard events

3. Update prospects.py (or main index route):
   - Check if user is authenticated AND onboarding_step == 0 AND first_login_at is None
   - If so, set first_login_at to now, pass show_welcome_modal=True to template
   - Otherwise pass show_welcome_modal=False

Modal styling should match existing card styling (rounded-lg, shadow-sm, border-gray-200).
  </action>
  <verify>
Start dev server, login as new user (or reset onboarding_step to 0), refresh index page - modal should appear
  </verify>
  <done>
Welcome modal appears on first login, "Let's go" marks step complete via API, "I'll figure it out" skips onboarding, modal doesn't reappear on subsequent visits
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Onboarding API endpoints and welcome modal for first-time users</what-built>
  <how-to-verify>
    1. Start dev server: `make run` or `uvicorn prospect.web.app:app --reload`
    2. Create a new user account (or reset existing user's onboarding_step to 0 in DB)
    3. Login and visit the main page
    4. Confirm welcome modal appears with:
       - "Welcome to PCC" headline
       - Value proposition text
       - "Let's go →" button
       - "I'll figure it out" link
    5. Click "Let's go →" - modal should close
    6. Refresh page - modal should NOT reappear
    7. Check API: GET /api/v1/onboarding/status shows current_step >= 1
  </how-to-verify>
  <resume-signal>Type "approved" to continue to Plan 02-02, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] GET /api/v1/onboarding/status returns correct JSON structure
- [ ] POST /api/v1/onboarding/step/welcome_seen updates user record
- [ ] POST /api/v1/onboarding/skip marks onboarding complete
- [ ] Welcome modal appears for new users (onboarding_step == 0)
- [ ] Modal closes and doesn't reappear after interaction
- [ ] No console errors in browser
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript/Python errors
- Onboarding status persists across page refreshes
- Modal only appears once per user
</success_criteria>

<output>
After completion, create `.planning/phases/02-onboarding-experience/02-01-SUMMARY.md`
</output>
